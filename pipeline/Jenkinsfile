pipeline {
    agent any
    triggers {
        pollSCM 'H/15 * * * *'
    }
    stages {
        stage("Determine products and tests to run.") {
            steps {
                script {
                    def diff = sh(returnStdout: true, script: "git diff origin/master... --name-only")
                    def productsToBuild = (diff.trim() =~ /(?sm)products\/(.*)\/.*/)
                    productsToBuild[0].unique(false).each {
                        print ("Product found: ${it}")
                    }
                }
            }
        }
    }
}